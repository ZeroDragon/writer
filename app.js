let setCursor=(e,t)=>{var a=document.createRange(),n=window.getSelection();a.setStart(e,t),a.collapse(!0),n.removeAllRanges(),n.addRange(a)},audioContext=new(window.AudioContext||window.webkitAudioContext),app=new Zero("app",{data:{wordCount:0,content:"",sfx:"music_off",soundOn:!1,theme:"dark_mode",themeName:"dark",zenMode:"self_improvement",zenOn:!1,timerIsRunning:!1,writeTimer:0},preload:async d=>{var e={keys:Array.from({length:9},(e,t)=>("0"+(t+1)).slice(-2)).map(e=>"key-"+e),special:["backspace","return","return-2","space-2","space"]},t=[...e.keys,...e.special],e=(d.data.soundsMap=e,d.data.sounds=await Promise.all(t.map(async e=>{var t;return t=`assets/${e}.mp3`,t=await(await fetch(t)).arrayBuffer(),{name:e,audio:await audioContext.decodeAudioData(t)}})),d.soundName=a=>{let t=e=>{if(" "===a.key)return"space-2";if("Enter"===a.key)return"return";if("Load"===a.key)return"return-2";if("Backspace"===a.key)return"backspace";if(/^[a-zA-Z0-9]$/.test(a.key)){var t=a.key.toLowerCase().charCodeAt(0)-97;if(0<=t&&t<26)return t=t%d.data.soundsMap.keys.length,d.data.soundsMap.keys[t];if(/^[0-9]$/.test(a.key))return t=(parseInt(a.key,10)-1)%d.data.soundsMap.keys.length,d.data.soundsMap.keys[t]}return"space"};var e,n;t()&&(e=d.data.sounds.find(e=>e.name===t()))&&((n=audioContext.createBufferSource()).buffer=e.audio,n.connect(audioContext.destination),n.start(0))},d.timer=setInterval(()=>{d.element.querySelectorAll("[z\\:tick]").forEach(e=>{e.dispatchEvent(new CustomEvent("tick"))})},1e3),window.localStorage.getItem("writerAppData")),{soundOn:t,themeName:a}=JSON.parse(window.localStorage.getItem("writerAppSettings"))||{};a&&(d.data.themeName=a),void 0!==t&&(d.data.soundOn=t),e&&(d.data.content=e),app.data.sfx=d.data.soundOn?"music_note":"music_off",app.data.theme="dark"===d.data.themeName?"dark_mode":"light_mode",d.data.wordCount=d.methods.countWords(app.data.content),app.updateDom()},methods:{countWords:e=>{var t=document.createElement("div");return t.innerHTML=e,t.innerHTML.replace(/<[^>]+>/g," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().split(" ").filter(e=>0<e.length).length},saveSettings:()=>{window.localStorage.setItem("writerAppSettings",JSON.stringify({soundOn:app.data.soundOn,themeName:app.data.themeName}))},newDraft:()=>{app.data.content="",app.data.wordCount=0,window.localStorage.setItem("writerAppData",app.data.content),app.methods.closeModal(),app.updateDom()},"{{theme}}":()=>{"dark"===app.data.themeName?(app.data.theme="light_mode",app.data.themeName="light"):(app.data.theme="dark_mode",app.data.themeName="dark"),app.methods.saveSettings(),app.updateDom(["themeName"])},"{{sfx}}":()=>{app.data.soundOn=!app.data.soundOn,app.data.sfx=app.data.soundOn?"music_note":"music_off",app.updateDom(["soundOn","{{sfx}}"]),app.data.soundOn&&app.soundName({key:"Load"}),app.methods.saveSettings()},"{{zenMode}}":()=>{var e;app.data.zenOn=!app.data.zenOn,app.data.zenMode=app.data.zenOn?"local_pizza":"self_improvement",app.updateDom(["zenOn","{{zenMode}}"]),app.data.zenOn||(e=document.getElementById("content"),Array.from(e.children).forEach(e=>{e.classList.remove("dimmed")}))},closeModal:()=>{app.data.modal.visible=!1,app.updateDom()},fullscreen:()=>{if(!document.fullscreenElement)return document.documentElement.requestFullscreen();document.exitFullscreen()},insert_drive_file:()=>{app.data.modal={visible:!0,title:"New Draft",message:"Start a new draft? All changes will be lost.",buttons:{primary:{text:"Cancel",action:"closeModal"},warning:{text:"New Draft",action:"newDraft"}}},app.bindEvents(),app.updateDom()},save:()=>{var e=new Blob([app.data.content],{type:"text/html"}),e=URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="draft.html",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)},help_outlined:()=>{app.data.modal={visible:!0,title:"Keyboard Shortcuts",message:document.getElementById("helpData").innerHTML,buttons:{primary:{text:"Close",action:"closeModal"}}},app.bindEvents(),app.updateDom()},createSound:e=>{app.data.soundOn&&(app.data.lastKeyTime||(app.data.lastKeyTime=0),app.data.lastKeyTime+500>(new Date).getTime()&&app.data.lastKey===e.key||(app.soundName(e),app.data.lastKeyTime=(new Date).getTime(),app.data.lastKey=e.key))},updateContent:t=>{if(t.altKey&&"s"===t.key.toLowerCase())return app.methods.save();if(t.altKey&&t.key&&"n"===t.key.toLowerCase())return app.methods.draft();if(t.altKey||t.ctrlKey){var a=window.getSelection();if(!a.rangeCount)return;a=a.getRangeAt(0);let e=a.startContainer;for(;e&&e!==t.target&&(e.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(e.tagName));)e=e.parentNode;if(!e||e===t.target)return;var a=a.startOffset,n=null;if([0,1,2].includes(~~t.key)){var d=["DIV","H1","H2"][t.key];if(!d)return;(n=document.createElement(d)).textContent=e.textContent,e.parentNode.replaceChild(n,e),setCursor(n?.firstChild||e,a)}void([3,4,5,6].includes(~~t.key)&&(e.classList.toggle("align-left","3"===t.key),e.classList.toggle("align-center","4"===t.key),e.classList.toggle("align-right","5"===t.key),e.classList.toggle("align-justify","6"===t.key)))}else t.target.firstChild&&t.target.firstChild.nodeType===Node.TEXT_NODE&&((d=document.createElement("div")).textContent=t.target.firstChild.textContent,t.target.replaceChild(d,t.target.firstChild),setCursor(d,1)),app.data.content=t.target.innerHTML,window.localStorage.setItem("writerAppData",app.data.content),app.data.wordCount=app.methods.countWords(app.data.content),app.updateDom(["wordCount"]),app.methods.tryZenMode(t)},tryZenMode:e=>{if(app.data.zenOn){var a=document.getElementById("content"),n=window.getSelection();if(n.rangeCount){let t=n.getRangeAt(0).startContainer;for(;t&&t!==e.target&&(t.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(t.tagName));)t=t.parentNode;t&&t!==a&&""!==t.innerText.trim()&&Array.from(a.children).forEach(e=>{e!==t?e.classList.add("dimmed"):e.classList.remove("dimmed")})}}},transformTime:e=>{let[t,a,n]=[0,0,0];return n=e%60,60<=(a=Math.floor(e/60))&&(t=Math.floor(a/60),a%=60),{hh:t,mm:a,ss:n}},incrementTimeLeft:e=>{app.data.writeTimer+=30,app.data.timerIsRunning=!0,app.methods.updateTimeGoal()},updateTimeGoal:e=>{var{hh:t,mm:a,ss:n}=app.methods.transformTime(app.data.writeTimer),t=[t,a,n].map(e=>("00"+e).slice(-2)).join(":");app.data.timeGoal="","00:00:00"!==t&&(app.data.timeGoal=t),app.updateDom(["timeGoal"])},startEditingTimeGoal:e=>{app.data.timerIsRunning=!1},setTimeGoal:n=>{app.data.timerIsRunning=!0;n=n.target.value;if(/^((\d{1,2}):)?((\d{1,2}):)?(\d{1,2})$/.exec(n)){let[e,t,a]=[0,0,0];var d,d=(3===(d=n.split(":")).length?[e,t,a]=d.map(e=>parseInt(e,10)||0):2===d.length?[t,a]=d.map(e=>parseInt(e,10)||0):a=parseInt(n,10)||0,3600*e+60*t+a);app.data.writeTimer=d}else app.data.writeTimer=0;app.methods.updateTimeGoal()},tickTimeGoal:e=>{app.data.timerIsRunning&&(--app.data.writeTimer,app.methods.updateTimeGoal(),app.data.writeTimer=Math.max(0,app.data.writeTimer),0===app.data.writeTimer)&&(app.data.timerIsRunning=!1,app.updateDom(["timerIsRunning"]))},resetTimeGoal:e=>{app.data.writeTimer=0,app.data.timerIsRunning=!1,app.methods.updateTimeGoal(),app.updateDom(["timerIsRunning"])}}});