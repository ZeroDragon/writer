let setCursor=(e,a)=>{var t=document.createRange(),n=window.getSelection();t.setStart(e,a),t.collapse(!0),n.removeAllRanges(),n.addRange(t)},audioContext=new(window.AudioContext||window.webkitAudioContext),getLS=()=>{var e=window.localStorage.getItem("writerAppData"),{soundOn:a,themeName:t,zenOn:n,ignoredWords:d}=JSON.parse(window.localStorage.getItem("writerAppSettings"))||{};return{savedData:e,soundOn:a,themeName:t,zenOn:n,ignoredWords:d}},app=new Zero("app",{data:{wordCount:0,content:getLS().savedData||"Start writing...",sfx:"music_off",soundOn:getLS().soundOn||!1,soundStatus:"SFX OFF",theme:"dark_mode",themeName:getLS().themeName||"dark",zenMode:"self_improvement",zenOn:getLS().zenOn||!1,zenStatus:"Zen Mode OFF",lock:"lock_open_right",lockdesc:"Encryption OFF",isEncrypted:!1,ignoredWords:getLS().ignoredWords||"",timerIsRunning:!1,writeTimer:0,wordGoal:"",lastWordCount:0,fileSystemAccessAPISupported:"showOpenFilePicker"in window},preload:async d=>{d.file=new File(d);var e={keys:Array.from({length:9},(e,a)=>("0"+(a+1)).slice(-2)).map(e=>"key-"+e),special:["backspace","return","return-2","space-2","space","alert-long","alert-short"]},a=[...e.keys,...e.special],e=(d.data.soundsMap=e,d.data.sounds=await Promise.all(a.map(async e=>{var a;return a=`assets/${e}.mp3`,a=await(await fetch(a)).arrayBuffer(),{name:e,audio:await audioContext.decodeAudioData(a)}})),d.soundName=t=>{let a=e=>{var a={" ":"space-2",Enter:"return",Load:"return-2",Backspace:"backspace",alert1:"alert-short",alert2:"alert-long"};if(a[t.key])return a[t.key];if(/^[a-zA-Z0-9]$/.test(t.key)){var a=t.key.toLowerCase().charCodeAt(0)-97;if(0<=a&&a<26)return a=a%d.data.soundsMap.keys.length,d.data.soundsMap.keys[a];if(/^[0-9]$/.test(t.key))return a=(parseInt(t.key,10)-1)%d.data.soundsMap.keys.length,d.data.soundsMap.keys[a]}return t.key.startsWith("Arrow")||["Shift","Control","Alt","Meta"].includes(t.key)?null:"space"};var e,n;a()&&(e=d.data.sounds.find(e=>e.name===a()))&&((n=audioContext.createBufferSource()).buffer=e.audio,n.connect(audioContext.destination),n.start(0))},d.timer=setInterval(()=>{d.element.querySelectorAll("[z\\:tick]").forEach(e=>{e.dispatchEvent(new CustomEvent("tick"))})},1e3),d.data.sfx=d.data.soundOn?"music_note":"music_off",d.data.theme="dark"===d.data.themeName?"dark_mode":"light_mode",d.data.zenMode=d.data.zenOn?"local_pizza":"self_improvement",d.data.soundStatus=d.data.soundOn?"SFX ON":"SFX OFF",d.data.zenStatus=d.data.zenOn?"Zen Mode ON":"Zen Mode OFF",d.data.wordCount=d.methods.countWords(d.data.content),document.getElementById("content"));Array.from(e.children).forEach(e=>{e.classList.remove("dimmed")}),d.updateDom(),d.methods.setContentFont(),"Start writing..."===d.data.content.trim()&&d.methods.info()},methods:{setContentFont:()=>{var e=document.getElementById("content");app.data.isEncrypted=app.methods.textIsEncrypted(),app.updateDom(["isEncrypted"]),app.data.isEncrypted?e.classList.add("encrypted"):e.classList.remove("encrypted")},countWords:e=>{var a=document.createElement("div");return a.innerHTML=e,a.innerHTML.replace(/<[^>]+>/g," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().split(" ").filter(e=>0<e.length).length},saveSettings:()=>{window.localStorage.setItem("writerAppSettings",JSON.stringify({soundOn:app.data.soundOn,themeName:app.data.themeName,zenOn:app.data.zenOn,ignoredWords:app.data.ignoredWords}))},newDraft:async()=>{app.data.content="Start writing...",app.data.wordCount=0,await app.methods.saveWriterData(),app.methods.closeModal(),app.updateDom(),app.methods.setContentFont(),app.file.close()},"{{theme}}":()=>{"dark"===app.data.themeName?(app.data.theme="light_mode",app.data.themeName="light"):(app.data.theme="dark_mode",app.data.themeName="dark"),app.methods.saveSettings(),app.updateDom(["themeName"])},"{{sfx}}":()=>{app.data.soundOn=!app.data.soundOn,app.data.sfx=app.data.soundOn?"music_note":"music_off",app.data.soundStatus=app.data.soundOn?"SFX ON":"SFX OFF",app.updateDom(["soundOn","{{sfx}}","soundStatus"]),app.data.soundOn&&app.soundName({key:"Load"}),app.methods.saveSettings()},"{{zenMode}}":()=>{var e;app.data.zenOn=!app.data.zenOn,app.data.zenMode=app.data.zenOn?"local_pizza":"self_improvement",app.data.zenStatus=app.data.zenOn?"Zen Mode ON":"Zen Mode OFF",app.updateDom(["zenOn","{{zenMode}}","zenStatus"]),app.data.zenOn||((e=document.getElementById("content")).classList.remove("dimmed"),Array.from(e.getElementsByClassName("focus")).forEach(e=>{e.classList.remove("focus")})),app.methods.saveSettings()},closeModal:()=>{app.data.modal.visible=!1,app.updateDom()},article:()=>{app.data.modal={visible:!0,title:"New Draft",message:"Start a new draft? All changes will be lost.",buttons:{primary:{text:"Cancel",action:"closeModal"},warning:{text:"New Draft",action:"newDraft"}}},app.bindEvents(),app.updateDom()},save:async()=>{await app.file.write()},upload_file:async()=>{await app.file.open()},info:()=>{app.data.modal={visible:!0,title:"About Writeros",message:document.getElementById("infoData").innerHTML,buttons:{secondary:{text:"Close",action:"closeModal"},primary:{text:"Buy me a coffee",action:"coffee"}}},app.bindEvents(),app.updateDom()},coffee:()=>{window.open("https://buymeacoffee.com/zerodragon","_blank")},createSound:e=>{app.data.soundOn&&(app.data.lastKeyTime||(app.data.lastKeyTime=0),app.data.lastKeyTime+200>(new Date).getTime()&&app.data.lastKey===e.key||(app.soundName(e),app.data.lastKeyTime=(new Date).getTime(),app.data.lastKey=e.key))},saveWriterData:async()=>{window.localStorage.setItem("writerAppData",await app.methods.encryptText())},tryAutoSave:async()=>{app.data.saveTimeout&&clearTimeout(app.data.saveTimeout),app.data.saveTimeout=setTimeout(async()=>{await app.methods.saveWriterData(),app.data.savingStatus="saving",app.updateDom(["savingStatus"]),setTimeout(()=>{app.data.savingStatus="",app.updateDom(["savingStatus"])},500),delete app.data.saveTimeout},1e3)},updateContent:e=>{var a;e.target.firstChild&&e.target.firstChild.nodeType===Node.TEXT_NODE&&((a=document.createElement("div")).textContent=e.target.firstChild.textContent,e.target.replaceChild(a,e.target.firstChild),setCursor(a,1)),app.data.content!==e.target.innerHTML&&(app.data.content=e.target.innerHTML,app.methods.tryAutoSave(),app.data.wordCount=app.methods.countWords(app.data.content),app.data.wordCount!==app.data.lastWordCount&&(app.data.wordGoal&&app.data.wordCount===app.data.wordGoal-1&&app.soundName({key:"alert1"}),app.data.lastWordCount=app.data.wordCount),app.data.writing="writing",app.data.expandedSidebar="",app.data.hiddenSidebar="hiddenSidebar",app.updateDom(["wordCount","writing","expandedSidebar","hiddenSidebar"]),app.methods.tryZenMode(e))},getSelectionParent:(e=!1)=>{let a=null,t=document.getElementById("content");var n=window.getSelection();return 0<n.rangeCount&&(n=n.getRangeAt(0),a=n.startContainer.parentElement),e?a===t?null:a:a===t?()=>{}:e=>{a.style.textAlign=e,setCursor(a.firstChild,a.firstChild.length),app.data.content=t.innerHTML,app.methods.saveWriterData()}},format_align_left:()=>{app.methods.getSelectionParent()("left")},format_align_center:()=>{app.methods.getSelectionParent()("center")},format_align_right:()=>{app.methods.getSelectionParent()("right")},format_align_justify:()=>{app.methods.getSelectionParent()("justify")},format_text:e=>{var a=app.methods.getSelectionParent(!0);a&&((e=document.createElement(e)).innerHTML=a.innerHTML,a.replaceWith(e),setCursor(e.firstChild,e.firstChild.length),a=document.getElementById("content"),app.data.content=a.innerHTML,app.methods.saveWriterData())},format_h1:()=>{app.methods.format_text("h1")},format_h2:()=>{app.methods.format_text("h2")},format_paragraph:()=>{app.methods.format_text("div")},tryZenMode:a=>{if("Start writing..."===app.data.content.trim()&&(app.data.content="",app.updateDom(["wordCount","content"])),app.data.zenOn){var t=document.getElementById("content"),n=window.getSelection();if(n.rangeCount){let e=n.getRangeAt(0).startContainer;for(;e&&!["DIV","H1","H2"].includes(e.tagName);)e=e.parentNode;for(;e&&e!==a.target&&(e.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(e.tagName));)e=e.parentNode;e&&e!==t&&""!==e.innerText.trim()&&(t.classList.add("dimmed"),e.classList.add("skip"),t.querySelectorAll(".focus:not(.skip)").forEach(e=>{e.classList.remove("focus")}),e.classList.contains("focus")||e.classList.add("focus"),e.classList.remove("skip"))}}},transformTime:e=>{let[a,t,n]=[0,0,0];return n=e%60,60<=(t=Math.floor(e/60))&&(a=Math.floor(t/60),t%=60),{hh:a,mm:t,ss:n}},incrementTimeLeft:e=>{app.data.writeTimer+=30,app.data.timerIsRunning=!0,app.methods.updateTimeGoal()},updateTimeGoal:e=>{var{hh:a,mm:t,ss:n}=app.methods.transformTime(app.data.writeTimer),a=[a,t,n].map(e=>("00"+e).slice(-2)).join(":");app.data.timeGoal="","00:00:00"!==a&&(app.data.timeGoal=a),app.updateDom(["timeGoal"])},startEditingTimeGoal:e=>{app.data.timerIsRunning=!1},setTimeGoal:n=>{app.data.timerIsRunning=!0;n=n.target.value;if(/^((\d{1,2}):)?((\d{1,2}):)?(\d{1,2})$/.exec(n)){let[e,a,t]=[0,0,0];var d,d=(3===(d=n.split(":")).length?[e,a,t]=d.map(e=>parseInt(e,10)||0):2===d.length?[a,t]=d.map(e=>parseInt(e,10)||0):t=parseInt(n,10)||0,3600*e+60*a+t);app.data.writeTimer=d}else app.data.writeTimer=0,app.data.timerIsRunning=!1;app.methods.updateTimeGoal()},tickTimeGoal:e=>{app.data.timerIsRunning&&(--app.data.writeTimer,app.methods.updateTimeGoal(),app.data.writeTimer=Math.max(0,app.data.writeTimer),5===app.data.writeTimer&&app.soundName({key:"alert2"}),0===app.data.writeTimer)&&(app.data.timerIsRunning=!1,app.updateDom(["timerIsRunning"]))},resetTimeGoal:e=>{app.data.writeTimer=0,app.data.timerIsRunning=!1,app.methods.updateTimeGoal(),app.updateDom(["timerIsRunning"])},setWordGoal:e=>{var a=e.target.value,a=parseInt(a,10);isNaN(a)||a<0?(app.data.wordGoal="",e.target.value=""):app.data.wordGoal=a},"{{lock}}":()=>{var e=document.getElementById("encryptInputs").cloneNode(!0),[e,a]=(app.data.modal={visible:!0,title:"Encryption",message:e,buttons:{secondary:{text:"Cancel",action:"closeModal"},primary:{text:"Set Encryption",action:"setLock"}}},app.bindEvents(),app.updateDom(),["encryptionKey","encryptionSecret"].map(e=>app.data.modal.message.querySelector(`.modal-content input[name="${e}"]`)));e.value=app.data.encryption?.key||"",a.value=app.data.encryption?.secret||""},textIsEncrypted:()=>{var e=app.data.content.replace(/<[^>]+>/g,"");return/^[0-9a-fA-F]+$/.test(e)&&e.length%32==0},encryptText:async()=>(app.data.content=app.data.content.replace(/ class="[^"]*"/g,""),!app.methods.textIsEncrypted()&&app.data.encryption?.key&&app.data.encryption?.secret?encryptText(app.data.content,app.data.encryption.key,app.data.encryption.secret):app.data.content),decryptText:()=>{var e=app.data.content.replace(/<[^>]+>/g,"");return decryptText(e,app.data.encryption.key,app.data.encryption.secret)},setLock:async()=>{var[e,a]=["encryptionKey","encryptionSecret"].map(e=>app.data.modal.message.querySelector(`.modal-content input[name="${e}"]`)),t=app.data.modal.message.querySelector('.modal-content input[name="decryptOnCloseModal"]').checked,n=app.data.modal.message.querySelector(".modal-content .error-message");if(n.style.display="none",app.data.encryption={key:e.value,secret:a.value},app.data.lock="lock",app.data.lockdesc="Encryption ON",e.value&&a.value||(app.data.lock="lock_open_right",app.data.lockdesc="Encryption OFF",await app.methods.saveWriterData()),t){let a=!1;if(app.data.content=await app.methods.decryptText().catch(e=>(a=!0,app.data.content)),a)return void(n.style.display="block");app.methods.setContentFont(),app.data.wordCount=app.methods.countWords(app.data.content)}await app.methods.saveWriterData(),app.methods.closeModal(),app.updateDom(["content","wordCount","{{lock}}"])},analytics:()=>{app.data.expandedSidebar=app.data.expandedSidebar?"":"expandedSidebar",app.data.expandedSidebar&&app.methods.runAnalytics(),app.updateDom(["expandedSidebar"])},updateIgnoredWords:e=>{e=e.target.value;app.data.ignoredWords=e.replace(/[\n,]+/g," ").split(/\s+/).map(e=>e.toLowerCase()).filter(Boolean),app.methods.runAnalytics(),app.methods.saveSettings(),app.updateDom(["ignoredWords"])},runAnalytics:async()=>{let t=document.getElementById("content").innerText.split(/\s+/).filter(Boolean),a={},p=(t.forEach(e=>{e=e.toLowerCase();a[e]=(a[e]||0)+1}),document.createElement("table"));var e=document.createElement("tr");e.innerHTML=`
        <th></th>
        <th>Word</th>
        <th>Count</th>
        <th>Freq</th>
      `,p.appendChild(e),Object.entries(a).filter(([e])=>!app.data.ignoredWords?.includes(e)).sort((e,a)=>a[1]-e[1]).map(([e,a])=>({word:e,count:a,percent:(a/t.length*100).toFixed(2)})).slice(0,20).forEach(({word:e,count:a,percent:t},n)=>{var d=document.createElement("tr");d.innerHTML=`
            <td>${n+1}</td>
            <td>${e}</td>
            <td>${a}</td>
            <td>${t}%</td>
          `,p.appendChild(d)}),app.data.analytics=p.outerHTML,app.data.lectureTime=(app.data.wordCount/130).toFixed(1)+" minutes",await app.updateDom(["analytics","lectureTime"]),document.querySelectorAll("#analytics table tr").forEach(a=>{a.addEventListener("click",()=>{var e=a.children[1].innerText;app.data.ignoredWords.includes(e)||(app.data.ignoredWords.push(e),app.methods.updateIgnoredWords({target:{value:app.data.ignoredWords.join("\n")}}))})})}}});document.addEventListener("keyup",e=>{"Escape"===e.key&&app.data.modal?.visible&&app.methods.closeModal()}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key.toLowerCase()&&(e.preventDefault(),app.methods.save())}),document.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.items&&"file"===e.dataTransfer.items[0].kind?(e.dataTransfer.dropEffect="copy",document.getElementById("dragOverlay").classList.add("active")):e.dataTransfer.dropEffect="none"}),document.addEventListener("dragleave",e=>{e.preventDefault(),e.relatedTarget&&"HTML"!==e.relatedTarget.nodeName||document.getElementById("dragOverlay").classList.remove("active")}),document.addEventListener("drop",e=>{e.preventDefault(),app.file.openDragged(e),document.getElementById("dragOverlay").classList.remove("active")}),document.addEventListener("mousemove",e=>{app.data.writing&&(delete app.data.writing,delete app.data.hiddenSidebar,app.updateDom(["writing","hiddenSidebar"]))});