let setCursor=(a,e)=>{var t=document.createRange(),n=window.getSelection();t.setStart(a,e),t.collapse(!0),n.removeAllRanges(),n.addRange(t)},audioContext=new(window.AudioContext||window.webkitAudioContext),app=new Zero("app",{data:{wordCount:0,content:"",sfx:"music_off",soundOn:!1,theme:"dark_mode",themeName:"dark",zenMode:"self_improvement",zenOn:!1,timerIsRunning:!1,writeTimer:0,wordGoal:"",lastWordCount:0},preload:async p=>{var a={keys:Array.from({length:9},(a,e)=>("0"+(e+1)).slice(-2)).map(a=>"key-"+a),special:["backspace","return","return-2","space-2","space","alert-long","alert-short"]},e=[...a.keys,...a.special],a=(p.data.soundsMap=a,p.data.sounds=await Promise.all(e.map(async a=>{var e;return e=`assets/${a}.mp3`,e=await(await fetch(e)).arrayBuffer(),{name:a,audio:await audioContext.decodeAudioData(e)}})),p.soundName=t=>{let e=a=>{var e={" ":"space-2",Enter:"return",Load:"return-2",Backspace:"backspace",alert1:"alert-short",alert2:"alert-long"};if(e[t.key])return e[t.key];if(/^[a-zA-Z0-9]$/.test(t.key)){var e=t.key.toLowerCase().charCodeAt(0)-97;if(0<=e&&e<26)return e=e%p.data.soundsMap.keys.length,p.data.soundsMap.keys[e];if(/^[0-9]$/.test(t.key))return e=(parseInt(t.key,10)-1)%p.data.soundsMap.keys.length,p.data.soundsMap.keys[e]}return"space"};var a,n;e()&&(a=p.data.sounds.find(a=>a.name===e()))&&((n=audioContext.createBufferSource()).buffer=a.audio,n.connect(audioContext.destination),n.start(0))},p.timer=setInterval(()=>{p.element.querySelectorAll("[z\\:tick]").forEach(a=>{a.dispatchEvent(new CustomEvent("tick"))})},1e3),window.localStorage.getItem("writerAppData")),{soundOn:e,themeName:t,zenOn:n}=JSON.parse(window.localStorage.getItem("writerAppSettings"))||{},t=(t&&(p.data.themeName=t),void 0!==e&&(p.data.soundOn=e),void 0!==n&&(p.data.zenOn=n),a&&(p.data.content=a),app.data.sfx=p.data.soundOn?"music_note":"music_off",app.data.theme="dark"===p.data.themeName?"dark_mode":"light_mode",app.data.zenMode=p.data.zenOn?"local_pizza":"self_improvement",p.data.wordCount=p.methods.countWords(app.data.content),document.getElementById("content"));Array.from(t.children).forEach(a=>{a.classList.remove("dimmed")}),app.updateDom()},methods:{countWords:a=>{var e=document.createElement("div");return e.innerHTML=a,e.innerHTML.replace(/<[^>]+>/g," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().split(" ").filter(a=>0<a.length).length},saveSettings:()=>{window.localStorage.setItem("writerAppSettings",JSON.stringify({soundOn:app.data.soundOn,themeName:app.data.themeName,zenOn:app.data.zenOn}))},newDraft:()=>{app.data.content="",app.data.wordCount=0,window.localStorage.setItem("writerAppData",app.data.content),app.methods.closeModal(),app.updateDom()},"{{theme}}":()=>{"dark"===app.data.themeName?(app.data.theme="light_mode",app.data.themeName="light"):(app.data.theme="dark_mode",app.data.themeName="dark"),app.methods.saveSettings(),app.updateDom(["themeName"])},"{{sfx}}":()=>{app.data.soundOn=!app.data.soundOn,app.data.sfx=app.data.soundOn?"music_note":"music_off",app.updateDom(["soundOn","{{sfx}}"]),app.data.soundOn&&app.soundName({key:"Load"}),app.methods.saveSettings()},"{{zenMode}}":()=>{var a;app.data.zenOn=!app.data.zenOn,app.data.zenMode=app.data.zenOn?"local_pizza":"self_improvement",app.updateDom(["zenOn","{{zenMode}}"]),app.data.zenOn||(a=document.getElementById("content"),Array.from(a.children).forEach(a=>{a.classList.remove("dimmed")})),app.methods.saveSettings()},closeModal:()=>{app.data.modal.visible=!1,app.updateDom()},article:()=>{app.data.modal={visible:!0,title:"New Draft",message:"Start a new draft? All changes will be lost.",buttons:{primary:{text:"Cancel",action:"closeModal"},warning:{text:"New Draft",action:"newDraft"}}},app.bindEvents(),app.updateDom()},save:async()=>{var a=await app.methods.encryptText(),a=new Blob([a],{type:"application/octet-stream"}),a=URL.createObjectURL(a),e=document.createElement("a");e.href=a,e.download="draft.wtr",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a)},upload_file:()=>{var a=document.createElement("input"),e=(a.type="file",/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints);a.accept=e?"text/*,.wtr,application/octet-stream":".txt,.wtr,text/plain",a.onchange=a=>{var e,a=a.target.files[0];a&&((e=new FileReader).onload=a=>{app.data.content=a.target.result,app.data.wordCount=app.methods.countWords(app.data.content),window.localStorage.setItem("writerAppData",app.data.content),app.updateDom()},e.readAsText(a))},a.click()},help_outlined:()=>{app.data.modal={visible:!0,title:"Keyboard Shortcuts",message:document.getElementById("helpData").innerHTML,buttons:{primary:{text:"Close",action:"closeModal"}}},app.bindEvents(),app.updateDom()},createSound:a=>{app.data.soundOn&&(app.data.lastKeyTime||(app.data.lastKeyTime=0),app.data.lastKeyTime+500>(new Date).getTime()&&app.data.lastKey===a.key||(app.soundName(a),app.data.lastKeyTime=(new Date).getTime(),app.data.lastKey=a.key))},updateContent:e=>{if(e.altKey&&"s"===e.key.toLowerCase())return app.methods.save();if(e.altKey&&e.key&&"n"===e.key.toLowerCase())return app.methods.draft();if(e.altKey||e.ctrlKey){var t=window.getSelection();if(!t.rangeCount)return;t=t.getRangeAt(0);let a=t.startContainer;for(;a&&a!==e.target&&(a.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(a.tagName));)a=a.parentNode;if(!a||a===e.target)return;var t=t.startOffset,n=null;if([0,1,2].includes(~~e.key)){var p=["DIV","H1","H2"][e.key];if(!p)return;(n=document.createElement(p)).textContent=a.textContent,a.parentNode.replaceChild(n,a),setCursor(n?.firstChild||a,t)}void([3,4,5,6].includes(~~e.key)&&(a.classList.toggle("align-left","3"===e.key),a.classList.toggle("align-center","4"===e.key),a.classList.toggle("align-right","5"===e.key),a.classList.toggle("align-justify","6"===e.key)))}else e.target.firstChild&&e.target.firstChild.nodeType===Node.TEXT_NODE&&((p=document.createElement("div")).textContent=e.target.firstChild.textContent,e.target.replaceChild(p,e.target.firstChild),setCursor(p,1)),app.data.content=e.target.innerHTML,window.localStorage.setItem("writerAppData",app.data.content),app.data.wordCount=app.methods.countWords(app.data.content),app.data.wordCount!==app.data.lastWordCount&&(app.data.wordGoal&&app.data.wordCount===app.data.wordGoal-1&&app.soundName({key:"alert1"}),app.data.lastWordCount=app.data.wordCount),app.updateDom(["wordCount"]),app.methods.tryZenMode(e)},tryZenMode:e=>{if(app.data.zenOn){var t=document.getElementById("content"),n=window.getSelection();if(n.rangeCount){let a=n.getRangeAt(0).startContainer;for(;a&&a!==e.target&&(a.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(a.tagName));)a=a.parentNode;a&&a!==t&&""!==a.innerText.trim()&&(t.classList.add("dimmed"),a.classList.add("skip"),t.querySelectorAll(".focus:not(.skip)").forEach(a=>{a.classList.remove("focus")}),a.classList.contains("focus")||a.classList.add("focus"),a.classList.remove("skip"))}}},transformTime:a=>{let[e,t,n]=[0,0,0];return n=a%60,60<=(t=Math.floor(a/60))&&(e=Math.floor(t/60),t%=60),{hh:e,mm:t,ss:n}},incrementTimeLeft:a=>{app.data.writeTimer+=30,app.data.timerIsRunning=!0,app.methods.updateTimeGoal()},updateTimeGoal:a=>{var{hh:e,mm:t,ss:n}=app.methods.transformTime(app.data.writeTimer),e=[e,t,n].map(a=>("00"+a).slice(-2)).join(":");app.data.timeGoal="","00:00:00"!==e&&(app.data.timeGoal=e),app.updateDom(["timeGoal"])},startEditingTimeGoal:a=>{app.data.timerIsRunning=!1},setTimeGoal:n=>{app.data.timerIsRunning=!0;n=n.target.value;if(/^((\d{1,2}):)?((\d{1,2}):)?(\d{1,2})$/.exec(n)){let[a,e,t]=[0,0,0];var p,p=(3===(p=n.split(":")).length?[a,e,t]=p.map(a=>parseInt(a,10)||0):2===p.length?[e,t]=p.map(a=>parseInt(a,10)||0):t=parseInt(n,10)||0,3600*a+60*e+t);app.data.writeTimer=p}else app.data.writeTimer=0,app.data.timerIsRunning=!1;app.methods.updateTimeGoal()},tickTimeGoal:a=>{app.data.timerIsRunning&&(--app.data.writeTimer,app.methods.updateTimeGoal(),app.data.writeTimer=Math.max(0,app.data.writeTimer),5===app.data.writeTimer&&app.soundName({key:"alert2"}),0===app.data.writeTimer)&&(app.data.timerIsRunning=!1,app.updateDom(["timerIsRunning"]))},resetTimeGoal:a=>{app.data.writeTimer=0,app.data.timerIsRunning=!1,app.methods.updateTimeGoal(),app.updateDom(["timerIsRunning"])},setWordGoal:a=>{var e=a.target.value,e=parseInt(e,10);isNaN(e)||e<0?(app.data.wordGoal="",a.target.value=""):app.data.wordGoal=e},lock:()=>{var a=document.getElementById("encryptInputs").cloneNode(!0),[a,e]=(app.data.modal={visible:!0,title:"Encryption",message:a,buttons:{secondary:{text:"Cancel",action:"closeModal"},primary:{text:"Set Encryption",action:"setLock"}}},app.bindEvents(),app.updateDom(),["encryptionKey","encryptionSecret"].map(a=>app.data.modal.message.querySelector(`.modal-content input[name="${a}"]`)));a.value=app.data.encryption?.key||"",e.value=app.data.encryption?.secret||""},encryptText:async()=>app.data.encryption?.key&&app.data.encryption?.secret?encryptText(app.data.content,app.data.encryption.key,app.data.encryption.secret):app.data.content,decryptText:()=>{var a=app.data.content.replace(/<[^>]+>/g,"");return decryptText(a,app.data.encryption.key,app.data.encryption.secret)},setLock:async()=>{var[a,e]=["encryptionKey","encryptionSecret"].map(a=>app.data.modal.message.querySelector(`.modal-content input[name="${a}"]`)),t=app.data.modal.message.querySelector('.modal-content input[name="decryptOnCloseModal"]').checked;app.data.encryption={key:a.value,secret:e.value},t&&(app.data.content=await app.methods.decryptText(),app.data.wordCount=app.methods.countWords(app.data.content),window.localStorage.setItem("writerAppData",app.data.content)),app.methods.closeModal(),app.updateDom()}}});