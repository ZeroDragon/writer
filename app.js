let setCursor=(t,e)=>{var a=document.createRange(),n=window.getSelection();a.setStart(t,e),a.collapse(!0),n.removeAllRanges(),n.addRange(a)},audioContext=new(window.AudioContext||window.webkitAudioContext),getLS=()=>{var t=window.localStorage.getItem("writerAppData"),{soundOn:e,themeName:a,zenOn:n}=JSON.parse(window.localStorage.getItem("writerAppSettings"))||{};return{savedData:t,soundOn:e,themeName:a,zenOn:n}},app=new Zero("app",{data:{wordCount:0,content:getLS().savedData||"Start writing...",sfx:"music_off",soundOn:getLS().soundOn||!1,soundStatus:"SFX OFF",theme:"dark_mode",themeName:getLS().themeName||"dark",zenMode:"self_improvement",zenOn:getLS().zenOn||!1,zenStatus:"Zen Mode OFF",lock:"lock_open_right",lockdesc:"Encryption OFF",timerIsRunning:!1,writeTimer:0,wordGoal:"",lastWordCount:0,fontSize:1},preload:async o=>{var t={keys:Array.from({length:9},(t,e)=>("0"+(e+1)).slice(-2)).map(t=>"key-"+t),special:["backspace","return","return-2","space-2","space","alert-long","alert-short"]},e=[...t.keys,...t.special],t=(o.data.soundsMap=t,o.data.sounds=await Promise.all(e.map(async t=>{var e;return e=`assets/${t}.mp3`,e=await(await fetch(e)).arrayBuffer(),{name:t,audio:await audioContext.decodeAudioData(e)}})),o.soundName=a=>{let e=t=>{var e={" ":"space-2",Enter:"return",Load:"return-2",Backspace:"backspace",alert1:"alert-short",alert2:"alert-long"};if(e[a.key])return e[a.key];if(/^[a-zA-Z0-9]$/.test(a.key)){var e=a.key.toLowerCase().charCodeAt(0)-97;if(0<=e&&e<26)return e=e%o.data.soundsMap.keys.length,o.data.soundsMap.keys[e];if(/^[0-9]$/.test(a.key))return e=(parseInt(a.key,10)-1)%o.data.soundsMap.keys.length,o.data.soundsMap.keys[e]}return"space"};var t,n;e()&&(t=o.data.sounds.find(t=>t.name===e()))&&((n=audioContext.createBufferSource()).buffer=t.audio,n.connect(audioContext.destination),n.start(0))},o.timer=setInterval(()=>{o.element.querySelectorAll("[z\\:tick]").forEach(t=>{t.dispatchEvent(new CustomEvent("tick"))})},1e3),o.data.sfx=o.data.soundOn?"music_note":"music_off",o.data.theme="dark"===o.data.themeName?"dark_mode":"light_mode",o.data.zenMode=o.data.zenOn?"local_pizza":"self_improvement",o.data.soundStatus=o.data.soundOn?"SFX ON":"SFX OFF",o.data.zenStatus=o.data.zenOn?"Zen Mode ON":"Zen Mode OFF",o.data.wordCount=o.methods.countWords(o.data.content),document.getElementById("content"));Array.from(t.children).forEach(t=>{t.classList.remove("dimmed")}),o.updateDom(),o.methods.setContentFont(),"Start writing..."===o.data.content.trim()&&o.methods.info()},methods:{setContentFont:()=>{var t=document.getElementById("content");app.methods.textIsEncrypted()?t.classList.add("encrypted"):t.classList.remove("encrypted")},countWords:t=>{var e=document.createElement("div");return e.innerHTML=t,e.innerHTML.replace(/<[^>]+>/g," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().split(" ").filter(t=>0<t.length).length},saveSettings:()=>{window.localStorage.setItem("writerAppSettings",JSON.stringify({soundOn:app.data.soundOn,themeName:app.data.themeName,zenOn:app.data.zenOn}))},newDraft:async()=>{app.data.content="Start writing...",app.data.wordCount=0,await app.methods.saveWriterData(),app.methods.closeModal(),app.updateDom()},"{{theme}}":()=>{"dark"===app.data.themeName?(app.data.theme="light_mode",app.data.themeName="light"):(app.data.theme="dark_mode",app.data.themeName="dark"),app.methods.saveSettings(),app.updateDom(["themeName"])},"{{sfx}}":()=>{app.data.soundOn=!app.data.soundOn,app.data.sfx=app.data.soundOn?"music_note":"music_off",app.data.soundStatus=app.data.soundOn?"SFX ON":"SFX OFF",app.updateDom(["soundOn","{{sfx}}","soundStatus"]),app.data.soundOn&&app.soundName({key:"Load"}),app.methods.saveSettings()},"{{zenMode}}":()=>{var t;app.data.zenOn=!app.data.zenOn,app.data.zenMode=app.data.zenOn?"local_pizza":"self_improvement",app.data.zenStatus=app.data.zenOn?"Zen Mode ON":"Zen Mode OFF",app.updateDom(["zenOn","{{zenMode}}","zenStatus"]),app.data.zenOn||((t=document.getElementById("content")).classList.remove("dimmed"),Array.from(t.getElementsByClassName("focus")).forEach(t=>{t.classList.remove("focus")})),app.methods.saveSettings()},closeModal:()=>{app.data.modal.visible=!1,app.updateDom()},article:()=>{app.data.modal={visible:!0,title:"New Draft",message:"Start a new draft? All changes will be lost.",buttons:{primary:{text:"Cancel",action:"closeModal"},warning:{text:"New Draft",action:"newDraft"}}},app.bindEvents(),app.updateDom()},save:async()=>{var t=await app.methods.encryptText(),t=new Blob([t],{type:"application/octet-stream"}),t=URL.createObjectURL(t),e=document.createElement("a");e.href=t,e.download="draft.wtr",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(t)},upload_file:()=>{var t=document.createElement("input"),e=(t.type="file",/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints);t.accept=e?"text/*,.wtr,application/octet-stream":".txt,.wtr,text/plain",t.onchange=t=>{var e,t=t.target.files[0];t&&((e=new FileReader).onload=t=>{app.data.content=t.target.result,app.methods.setContentFont(),app.data.wordCount=app.methods.countWords(app.data.content),app.methods.saveWriterData(),app.updateDom()},e.readAsText(t))},t.click()},info:()=>{app.data.modal={visible:!0,title:"About Writeros",message:document.getElementById("infoData").innerHTML,buttons:{secondary:{text:"Close",action:"closeModal"},primary:{text:"Buy me a coffee",action:"coffee"}}},app.bindEvents(),app.updateDom()},coffee:()=>{window.open("https://buymeacoffee.com/zerodragon","_blank")},createSound:t=>{app.data.soundOn&&(app.data.lastKeyTime||(app.data.lastKeyTime=0),app.data.lastKeyTime+500>(new Date).getTime()&&app.data.lastKey===t.key||(app.soundName(t),app.data.lastKeyTime=(new Date).getTime(),app.data.lastKey=t.key))},saveWriterData:async()=>{window.localStorage.setItem("writerAppData",await app.methods.encryptText())},tryAutoSave:async()=>{app.data.saveTimeout&&clearTimeout(app.data.saveTimeout),app.data.saveTimeout=setTimeout(async()=>{await app.methods.saveWriterData(),app.data.savingStatus="saving",app.updateDom(["savingStatus"]),setTimeout(()=>{app.data.savingStatus="",app.updateDom(["savingStatus"])},500),delete app.data.saveTimeout},1e3)},updateContent:t=>{var e;t.target.firstChild&&t.target.firstChild.nodeType===Node.TEXT_NODE&&((e=document.createElement("div")).textContent=t.target.firstChild.textContent,t.target.replaceChild(e,t.target.firstChild),setCursor(e,1)),app.data.content=t.target.innerHTML,app.methods.tryAutoSave(),app.data.wordCount=app.methods.countWords(app.data.content),app.data.wordCount!==app.data.lastWordCount&&(app.data.wordGoal&&app.data.wordCount===app.data.wordGoal-1&&app.soundName({key:"alert1"}),app.data.lastWordCount=app.data.wordCount),app.data.writing="writing",app.updateDom(["wordCount","writing"]),app.methods.tryZenMode(t)},getSelectionParent:(t=!1)=>{let e=null;var a=window.getSelection();return 0<a.rangeCount&&(a=a.getRangeAt(0),e=a.startContainer.parentElement),t?e:t=>{e.style.textAlign=t,setCursor(e.firstChild,e.firstChild.length);t=document.getElementById("content");app.data.content=t.innerHTML,app.methods.saveWriterData()}},format_align_left:()=>{app.methods.getSelectionParent()("left")},format_align_center:()=>{app.methods.getSelectionParent()("center")},format_align_right:()=>{app.methods.getSelectionParent()("right")},format_align_justify:()=>{app.methods.getSelectionParent()("justify")},format_text:t=>{var e=app.methods.getSelectionParent(!0),t=document.createElement(t),e=(t.innerHTML=e.innerHTML,e.replaceWith(t),setCursor(t.firstChild,t.firstChild.length),document.getElementById("content"));app.data.content=e.innerHTML,app.methods.saveWriterData()},format_h1:()=>{app.methods.format_text("h1")},format_h2:()=>{app.methods.format_text("h2")},format_paragraph:()=>{app.methods.format_text("div")},updateFontSize:()=>{document.getElementById("content").style.fontSize=app.data.fontSize+"em"},zoom_in:()=>{app.data.fontSize=Math.min(app.data.fontSize+.1,3),app.methods.updateFontSize()},zoom_out:()=>{app.data.fontSize=Math.max(app.data.fontSize-.1,.5),app.methods.updateFontSize()},search_check:()=>{app.data.fontSize=1,app.methods.updateFontSize()},tryZenMode:e=>{if("Start writing..."===app.data.content.trim()&&(app.data.content="",app.updateDom(["wordCount","content"])),app.data.zenOn){var a=document.getElementById("content"),n=window.getSelection();if(n.rangeCount){let t=n.getRangeAt(0).startContainer;for(;t&&!["DIV","H1","H2"].includes(t.tagName);)t=t.parentNode;for(;t&&t!==e.target&&(t.nodeType!==Node.ELEMENT_NODE||!["DIV","H1","H2"].includes(t.tagName));)t=t.parentNode;t&&t!==a&&""!==t.innerText.trim()&&(a.classList.add("dimmed"),t.classList.add("skip"),a.querySelectorAll(".focus:not(.skip)").forEach(t=>{t.classList.remove("focus")}),t.classList.contains("focus")||t.classList.add("focus"),t.classList.remove("skip"))}}},transformTime:t=>{let[e,a,n]=[0,0,0];return n=t%60,60<=(a=Math.floor(t/60))&&(e=Math.floor(a/60),a%=60),{hh:e,mm:a,ss:n}},incrementTimeLeft:t=>{app.data.writeTimer+=30,app.data.timerIsRunning=!0,app.methods.updateTimeGoal()},updateTimeGoal:t=>{var{hh:e,mm:a,ss:n}=app.methods.transformTime(app.data.writeTimer),e=[e,a,n].map(t=>("00"+t).slice(-2)).join(":");app.data.timeGoal="","00:00:00"!==e&&(app.data.timeGoal=e),app.updateDom(["timeGoal"])},startEditingTimeGoal:t=>{app.data.timerIsRunning=!1},setTimeGoal:n=>{app.data.timerIsRunning=!0;n=n.target.value;if(/^((\d{1,2}):)?((\d{1,2}):)?(\d{1,2})$/.exec(n)){let[t,e,a]=[0,0,0];var o,o=(3===(o=n.split(":")).length?[t,e,a]=o.map(t=>parseInt(t,10)||0):2===o.length?[e,a]=o.map(t=>parseInt(t,10)||0):a=parseInt(n,10)||0,3600*t+60*e+a);app.data.writeTimer=o}else app.data.writeTimer=0,app.data.timerIsRunning=!1;app.methods.updateTimeGoal()},tickTimeGoal:t=>{app.data.timerIsRunning&&(--app.data.writeTimer,app.methods.updateTimeGoal(),app.data.writeTimer=Math.max(0,app.data.writeTimer),5===app.data.writeTimer&&app.soundName({key:"alert2"}),0===app.data.writeTimer)&&(app.data.timerIsRunning=!1,app.updateDom(["timerIsRunning"]))},resetTimeGoal:t=>{app.data.writeTimer=0,app.data.timerIsRunning=!1,app.methods.updateTimeGoal(),app.updateDom(["timerIsRunning"])},setWordGoal:t=>{var e=t.target.value,e=parseInt(e,10);isNaN(e)||e<0?(app.data.wordGoal="",t.target.value=""):app.data.wordGoal=e},"{{lock}}":()=>{var t=document.getElementById("encryptInputs").cloneNode(!0),[t,e]=(app.data.modal={visible:!0,title:"Encryption",message:t,buttons:{secondary:{text:"Cancel",action:"closeModal"},primary:{text:"Set Encryption",action:"setLock"}}},app.bindEvents(),app.updateDom(),["encryptionKey","encryptionSecret"].map(t=>app.data.modal.message.querySelector(`.modal-content input[name="${t}"]`)));t.value=app.data.encryption?.key||"",e.value=app.data.encryption?.secret||""},textIsEncrypted:()=>{var t=app.data.content.replace(/<[^>]+>/g,"");return/^[0-9a-fA-F]+$/.test(t)&&t.length%32==0},encryptText:async()=>(app.data.content=app.data.content.replace(/ class="[^"]*"/g,""),!app.methods.textIsEncrypted()&&app.data.encryption?.key&&app.data.encryption?.secret?encryptText(app.data.content,app.data.encryption.key,app.data.encryption.secret):app.data.content),decryptText:()=>{var t=app.data.content.replace(/<[^>]+>/g,"");return decryptText(t,app.data.encryption.key,app.data.encryption.secret)},setLock:async()=>{var[t,e]=["encryptionKey","encryptionSecret"].map(t=>app.data.modal.message.querySelector(`.modal-content input[name="${t}"]`)),a=app.data.modal.message.querySelector('.modal-content input[name="decryptOnCloseModal"]').checked,n=app.data.modal.message.querySelector(".modal-content .error-message");if(n.style.display="none",app.data.encryption={key:t.value,secret:e.value},app.data.lock="lock",app.data.lockdesc="Encryption ON",t.value&&e.value||(app.data.lock="lock_open_right",app.data.lockdesc="Encryption OFF",await app.methods.saveWriterData()),a){let e=!1;if(app.data.content=await app.methods.decryptText().catch(t=>(e=!0,app.data.content)),e)return void(n.style.display="block");app.methods.setContentFont(),app.data.wordCount=app.methods.countWords(app.data.content)}await app.methods.saveWriterData(),app.methods.closeModal(),app.updateDom(["content","wordCount","{{lock}}"])}}});document.addEventListener("keyup",t=>{"Escape"===t.key&&app.data.modal?.visible&&app.methods.closeModal()}),document.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.items&&"file"===t.dataTransfer.items[0].kind?(t.dataTransfer.dropEffect="copy",document.getElementById("dragOverlay").classList.add("active")):t.dataTransfer.dropEffect="none"}),document.addEventListener("dragleave",t=>{t.preventDefault(),t.relatedTarget&&"HTML"!==t.relatedTarget.nodeName||document.getElementById("dragOverlay").classList.remove("active")}),document.addEventListener("drop",t=>{t.preventDefault();var e,t=t.dataTransfer.files[0];t&&((e=new FileReader).onload=t=>{app.data.content=t.target.result,app.data.wordCount=app.methods.countWords(app.data.content),app.methods.setContentFont(),app.methods.saveWriterData(),app.updateDom()},e.readAsText(t),document.getElementById("dragOverlay").classList.remove("active"))}),document.addEventListener("mousemove",t=>{app.data.writing&&(delete app.data.writing,app.updateDom(["writing"]))});